{"version":3,"file":"index.js","sources":["pages/index/index.vue","../../../../../soft/HBuilderX.4.84.2025102304-alpha/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<template>\n  <view class=\"page\">\n    <view class=\"bar\">\n      <picker mode=\"selector\" :range=\"statusOptions\" @change=\"onStatusChange\">\n        <view class=\"btn\">{{statusLabel}}</view>\n      </picker>\n      <input class=\"search\" placeholder=\"按SN或名称\" v-model=\"q\" @input=\"loadDevices\" />\n      <button class=\"btn\" @click=\"refresh\">刷新</button>\n    </view>\n    <scroll-view scroll-y class=\"list\">\n      <view v-for=\"d in list\" :key=\"d.SN||d.sn\" class=\"card\" @click=\"openDetail(d)\">\n        <view class=\"row\">\n          <text class=\"sn\">{{d.SN||d.sn}}</text>\n          <text class=\"status\" :class=\"'s-'+statusKey(d.status)\">{{statusText(d.status)}}</text>\n        </view>\n        <view class=\"row\"><text class=\"label\">名称</text><text class=\"val\">{{d.name||''}}</text></view>\n        <view class=\"row\"><text class=\"label\">寄出地址</text><text class=\"val\">{{d.lastShipAddress||''}}</text></view>\n        <view class=\"row\"><text class=\"label\">寄出时间</text><text class=\"val\">{{formatTime(d.lastShipAt)}}</text></view>\n        <view class=\"row\"><text class=\"label\">归还时间</text><text class=\"val\">{{formatTime(d.lastReturnAt)}}</text></view>\n      </view>\n    </scroll-view>\n    <view class=\"footer\">\n      <view class=\"footer-item disabled\">寄出</view>\n      <view class=\"footer-item active\" @click=\"refresh\">设备列表</view>\n      <view class=\"footer-item disabled\">归还</view>\n    </view>\n    <view class=\"modal\" v-if=\"showDetail\">\n      <view class=\"detail\">\n        <view class=\"row head\"><text>设备详情</text><button class=\"btn\" @click=\"closeDetail\">关闭</button></view>\n        <view class=\"row\"><text class=\"label\">SN</text><text class=\"val\">{{detail.SN||detail.sn}}</text></view>\n        <view class=\"row\"><text class=\"label\">名称</text><text class=\"val\">{{detail.name||''}}</text></view>\n        <view class=\"row\"><text class=\"label\">型号</text><text class=\"val\">{{detail.model||''}}</text></view>\n        <view class=\"row\"><text class=\"label\">负责人</text><text class=\"val\">{{detail.owner||''}}</text></view>\n        <view class=\"row\"><text class=\"label\">状态</text><text class=\"val\">{{statusText(detail.status)}}</text></view>\n        <view class=\"row\"><text class=\"label\">寄出地址</text><text class=\"val\">{{detail.lastShipAddress||''}}</text></view>\n        <view class=\"row\"><text class=\"label\">寄出时间</text><text class=\"val\">{{formatTime(detail.lastShipAt)}}</text></view>\n        <view class=\"row\"><text class=\"label\">归还时间</text><text class=\"val\">{{formatTime(detail.lastReturnAt)}}</text></view>\n      </view>\n    </view>\n  </view>\n  </template>\n  <script>\n  import cfg from '../../config.js'\n  export default {\n    data(){\n      return {\n        apiBase: cfg.apiBase,\n        statusOptions: ['全部','空闲','寄出中','已归还','维修中','报废'],\n        statusMap: { Idle:'空闲', Shipping:'寄出中', Returned:'已归还', Repairing:'维修中', Scrapped:'报废' },\n        statusLabel: '全部',\n        statusKeySel: '',\n        q: '',\n        list: [],\n        showDetail: false,\n        detail: {}\n      }\n    },\n    onLoad(){\n      this.loadDevices();\n    },\n    onShow(){\n      const tb = this.getTabBar && this.getTabBar()\n      if(tb && tb.setData){ tb.setData({ selected: 1 }) }\n    },\n    onPullDownRefresh(){\n      this.refresh();\n    },\n    methods:{\n      refresh(){ this.loadDevices(); uni.stopPullDownRefresh(); },\n      onStatusChange(e){ const i = parseInt(e.detail.value); this.statusLabel = this.statusOptions[i]; this.statusKeySel = this.statusKeyFromLabel(this.statusLabel); this.loadDevices(); },\n      statusKeyFromLabel(t){ if(t==='全部') return ''; const map = { '空闲':'Idle','寄出中':'Shipping','已归还':'Returned','维修中':'Repairing','报废':'Scrapped' }; return map[t] || ''; },\n      statusKey(v){ const names = ['Idle','Shipping','Returned','Repairing','Scrapped']; return typeof v==='number'? (names[v]||'') : v; },\n      statusText(v){ const k = this.statusKey(v); return this.statusMap[k] || k || ''; },\n      formatTime(v){ if(!v) return ''; const d = new Date(v); return `${d.getFullYear()}-${(d.getMonth()+1+'').padStart(2,'0')}-${(d.getDate()+'').padStart(2,'0')} ${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}`; },\n      async loadDevices(){\n        const url = `${this.apiBase}/api/devices`;\n        const qs = [];\n        if(this.statusKeySel) qs.push(`status=${this.statusKeySel}`);\n        if(this.q) qs.push(`q=${encodeURIComponent(this.q)}`);\n        const full = qs.length? `${url}?${qs.join('&')}` : url;\n        try{\n          const res = await uni.request({ url: full, method:'GET' });\n          this.list = Array.isArray(res.data)? res.data : [];\n        }catch(e){ uni.showToast({ title:'加载失败', icon:'none' }); }\n      },\n      openDetail(d){ this.detail = d; this.showDetail = true; },\n      closeDetail(){ this.showDetail = false; }\n    }\n  }\n  </script>\n  <style>\n  .page{ padding: 20rpx; }\n  .bar{ display:flex; gap: 16rpx; align-items:center; }\n  .btn{ padding: 10rpx 20rpx; background:#3b82f6; color:#fff; border-radius: 8rpx; font-size: 26rpx; }\n  .search{ flex:1; padding: 10rpx 20rpx; border:1rpx solid #ddd; border-radius: 8rpx; background:#fff; }\n  .list{ height: calc(100vh - 260rpx); margin-top: 20rpx; }\n  .card{ background:#fff; border:1rpx solid #eee; border-radius: 12rpx; padding: 20rpx; margin-bottom: 16rpx; }\n  .row{ display:flex; justify-content:space-between; margin-bottom: 10rpx; }\n  .sn{ font-weight: bold; }\n  .label{ color:#666; width:160rpx; }\n  .val{ flex:1; text-align:right; }\n  .status{ padding: 6rpx 12rpx; border-radius: 8rpx; font-size: 24rpx; }\n  .s-Idle{ background:#eaf3ff; color:#2563eb; }\n  .s-Shipping{ background:#eafaf5; color:#0f766e; }\n  .s-Returned{ background:#f1f5f9; color:#334155; }\n  .s-Repairing{ background:#fff7ed; color:#ea580c; }\n  .s-Scrapped{ background:#fce7f3; color:#be185d; }\n  .modal{ position:fixed; inset:0; background:rgba(0,0,0,.35); display:flex; align-items:center; justify-content:center; }\n  .detail{ width: 640rpx; background:#fff; border-radius: 12rpx; padding: 20rpx; }\n  .head{ align-items:center; }\n  .footer{ position:fixed; left:0; right:0; bottom:0; height: 120rpx; background:#fff; border-top:1rpx solid #eee; display:flex; }\n  .footer-item{ flex:1; text-align:center; line-height:120rpx; font-size: 34rpx; color:#666; }\n  .footer-item.active{ color:#3b82f6; font-weight: 600; }\n  .footer-item.disabled{ color:#999; }\n  </style>\n","import MiniProgramPage from 'D:/南禾网站建设/明源高端定制/小程序扫描条码设备登记/miniappdevice/appdevice/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["cfg","uni"],"mappings":"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"}