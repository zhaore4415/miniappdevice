## 问题定位
- 页面底部存在游离 JS 代码（在 `</html>` 之后），导致脚本被当成文本渲染并执行：`ensureAuthed()` 片段出现在页面中。该问题会影响鉴权检查并造成异常行为。
- `net::ERR_ABORTED` 出现在登录页发起 `fetch('/api/auth/login')` 后立即跳转的场景，属于导航导致的请求中断日志，功能上可用，但体验不佳。

## 修改方案
1. 整理前端脚本结构：
- 将 `ensureAuthed()` 函数与调用移入现有 `<script>` 标签内部，避免出现在 `</html>` 之后。
- 在脚本开头执行鉴权检查：`await fetch('/api/auth/me', { credentials: 'include' })`，未登录则跳转到 `/login.html`。
2. 登录请求细化：
- 在 `login.html` 的 `fetch('/api/auth/login')` 中补充 `credentials: 'include'`，确保会话 Cookie 写入与后续请求携带一致。
- 为避免 `ERR_ABORTED` 日志，登录成功后先 `await res.text()` 或改用 `setTimeout(() => location.href = '/', 0)` 再导航。
3. 其他受保护接口与页面：
- 保持后端中间件仅拦截静态页面（`/`, `/index.html`, `/qrcode.html`），不拦截 `/api/*`。
- 设备寄出/归还、批量二维码生成接口保持登录校验。

## 验证步骤
- 访问 `http://localhost:5000/login.html`，使用 `admin/admin123` 登录。
- 跳转到首页后确认不再出现脚本文本渲染；`/api/auth/me` 返回 200。
- 测试寄出/归还接口：未登录返回 401；登录后正常。
- 测试“批量生成二维码”：ZIP 下载与打印页正常打开。

请确认以上修改计划，确认后我将直接修复并回归测试。